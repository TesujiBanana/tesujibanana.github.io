require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("react"),d=(a("underscore"),a("../models/board.js")),e=a("./grid_view.jsx"),f=a("./intersections_view.jsx"),g=c.createClass({displayName:"BoardView",propTypes:{onIntersectionClick:c.PropTypes.func.isRequired,board:c.PropTypes.instanceOf(d).isRequired,current_turn:c.PropTypes.number},render:function(){var a=this.props.board.board_size;return c.DOM.div({className:"tesuji-board"},e({board_size:a}),f({board:this.props.board,current_turn:this.props.current_turn,onIntersectionClick:this.props.onIntersectionClick}))}});b.exports=g},{"../models/board.js":10,"./grid_view.jsx":2,"./intersections_view.jsx":4,react:"M6d2gk",underscore:"ZKusGn"}],2:[function(a,b){"use strict";var c=a("react"),d=a("underscore"),e=c.createClass({displayName:"GridView",propTypes:{board_size:c.PropTypes.number.isRequired},render:function(){var a=this.props.board_size;return c.DOM.div({className:"tesuji-grid"},c.DOM.table(null,c.DOM.tbody(null,d.times(a-1,function(b){return c.DOM.tr({key:b},d.times(a-1,function(a){return c.DOM.td({key:a},"Â ")}))}))),d.times(a,function(a){var b="ABCDEFGHJKLMNOPQRST".charAt(a);return c.DOM.div({className:"label label-top-"+a,key:a},b)}),d.times(a,function(a){var b="ABCDEFGHJKLMNOPQRST".charAt(a);return c.DOM.div({className:"label label-bottom-"+a,key:a},b)}),d.times(a,function(a){return c.DOM.div({className:"label label-left-"+a,key:a},a+1)}),d.times(a,function(a){return c.DOM.div({className:"label label-right-"+a,key:a},a+1)}),d.times(9,function(a){var b=3+6*(a%3),d=3+2*(a-a%3);return c.DOM.div({className:"dot intersection-"+b+"-"+d,key:a})}))}});b.exports=e},{react:"M6d2gk",underscore:"ZKusGn"}],3:[function(a,b){"use strict";var c=a("react"),d=(a("../models/stone.js"),a("./stone_view.jsx")),e=c.createClass({displayName:"IntersectionView",onMouseEnter:function(a){this.props.onMouseEnter({x:this.props.x,y:this.props.y},a)},render:function(){var a=[];return this.props.stone?a.push(d({stone:this.props.stone,key:"stone"})):this.props.preview&&a.push(c.DOM.div({className:"stone preview "+this.props.preview,key:"preview"})),c.DOM.div({className:"intersection intersection-"+this.props.x+"-"+this.props.y,onMouseEnter:this.onMouseEnter},a)}});b.exports=e},{"../models/stone.js":14,"./stone_view.jsx":5,react:"M6d2gk"}],4:[function(a,b){"use strict";var c=a("react"),d=a("underscore"),e=a("../models/stone.js"),f=a("./intersection_view.jsx"),g=c.createClass({displayName:"IntersectionsView",getInitialState:function(){return{cursor_position:{x:7,y:8}}},onClick:function(a){this.props.onIntersectionClick({x:this.state.cursor_position.x,y:this.state.cursor_position.y},a)},onIntersectionEnter:function(a){this.setState({cursor_position:{x:a.x,y:a.y}})},render:function(){var a=19;return c.DOM.div({className:"intersections",onClick:this.onClick},d.times(a*a,function(b){var c=b%a,d=(b-c)/a,g=this.props.board.stoneAt(c,d),h=this.state.cursor_position.x===c&&this.state.cursor_position.y===d?this.props.current_turn===e.BLACK?"black":"white":void 0;return f({x:c,y:d,key:b,onMouseEnter:this.onIntersectionEnter,stone:g,preview:h})}.bind(this)))}});b.exports=g},{"../models/stone.js":14,"./intersection_view.jsx":3,react:"M6d2gk",underscore:"ZKusGn"}],5:[function(a,b){var c=a("react"),d=(a("underscore"),a("../models/stone.js")),e=c.createClass({displayName:"StoneView",propTypes:{stone:c.PropTypes.instanceOf(d).isRequired},color:function(){return this.props.stone.color===d.BLACK?"black":this.props.stone.color===d.WHITE?"white":void 0},render:function(){return c.DOM.div(null,c.DOM.div({className:"stone "+this.color()}),c.DOM.div({className:"stone shadow"}))}});b.exports=e},{"../models/stone.js":14,react:"M6d2gk",underscore:"ZKusGn"}],uovHxG:[function(a,b){"use strict";var c=a("react"),d=(a("underscore"),a("../models/board.js"),a("../models/stone.js"),a("../models/game.js")),e=a("../models/move.js"),f=a("./board_view.jsx"),g=c.createClass({displayName:"TesujiApp",handleClick:function(a){if(a){var b=a.x,c=a.y;if(void 0!==b&&void 0!==c){var f=new d({moves:this.props.game.moves.concat(new e({x:b,y:c,color:this.props.game.current_turn})),current_turn:(this.props.game.current_turn+1)%2});f.board()&&(window.location.href="#/game/"+btoa(JSON.stringify(f)))}}},render:function(){return c.DOM.div(null,f({board:this.props.game.board(),current_turn:this.props.game.current_turn,onIntersectionClick:this.handleClick}),c.DOM.div(null,JSON.stringify(this.props.game)))}});b.exports=g},{"../models/board.js":10,"../models/game.js":"FA0ZaN","../models/move.js":13,"../models/stone.js":14,"./board_view.jsx":1,react:"M6d2gk",underscore:"ZKusGn"}],tesuji_app:[function(a,b){b.exports=a("uovHxG")},{}],8:[function(a,b){var c=a("underscore"),d=function(){};d.prototype.initialize=function(a){return a},d.extend=function(a){var b=this,d=function(b){c.extend(this,this.initialize(c.defaults(void 0!==b?b:{},a.defaults)))};return c.extend(d,b),d.prototype=c.extend(Object.create(b.prototype),a.methods),d},b.exports=d},{underscore:"ZKusGn"}],9:[function(a,b){var c=a("underscore"),d=a("../models/stone.js"),e=(a("../models/board.js"),function(a){this.message=a,this.name="InvalidMoveException"}),f={playMove:function(a,b){var c=a.slice(-1)[0];if(c.stoneAt(b.x,b.y))throw new e("stone already at ("+b.x+", "+b.y+")");var f=new d(b),g=c.placeStones(f),h=g.findKills(f);if(g=g.removeStones(h),this.checkSuicide(g,f))throw new e("stone placed in suicide");if(h&&h.length>0&&this.checkKo(a,g))throw new e("move violates rule of ko");return g},checkSuicide:function(a,b){return a.findDeadStones(b).length>0},checkKo:function(a,b){return a.some(function(a){return b.stones.length===a.stones.length&&c.isEqual(a.getOverlay(),b.getOverlay())})}};b.exports=f},{"../models/board.js":10,"../models/stone.js":14,underscore:"ZKusGn"}],10:[function(a,b){var c=a("underscore"),d=a("../lib/model.js"),e=d.extend({attributes:["board_size","stones"],methods:{initialize:function(a){return c.defaults(a,{board_size:19,stones:[]})},_coordinatesToIndex:function(a,b){return a+this.board_size*b},coordinatesOutOfBounds:function(a,b){return 0>a||a>=this.board_size||0>b||b>=this.board_size},stoneAt:function(a,b){return this.coordinatesOutOfBounds(a,b)?void 0:c.first(c.where(this.stones,{x:a,y:b}))||null},neighbors:function(a){return[this.stoneAt(a.x-1,a.y),this.stoneAt(a.x,a.y+1),this.stoneAt(a.x+1,a.y),this.stoneAt(a.x,a.y-1)]},getOverlay:function(a){var b=void 0!==a?a:this.stones;return c.object(b.map(function(a){return a.x+this.board_size*a.y}.bind(this)),b)},placeStones:function(){args=c.flatten(arguments);var a=c.filter(args,function(a){return!this.coordinatesOutOfBounds(a.x,a.y)&&!this.stoneAt(a.x,a.y)}.bind(this));return 0===a.length?null:new e({board_size:this.board_size,stones:this.stones.concat(a)})},removeStones:function(){args=c.flatten(arguments);var a=c.filter(args,function(a){return!this.coordinatesOutOfBounds(a.x,a.y)&&a===this.stoneAt(a.x,a.y)}.bind(this));return 0===a.length?this:new e({board_size:this.board_size,stones:c.values(c.omit(this.getOverlay(),c.keys(this.getOverlay(a))))})},findKills:function(a){return c.reduce(this.neighbors(a).filter(function(b){return b&&a.color!==b.color}),function(a,b){return c.contains(a,b)?a:a.concat(this.findDeadStones(b))}.bind(this),[])},findDeadStones:function(a){return function b(a,d,e){if(0===d.length)return e;var f=d[0],g=a.neighbors(f);return g.indexOf(null)>=0?[]:b(a,d.slice(1).concat(g.filter(function(a){return a&&f.color===a.color&&!c.contains(e,a)})),e.concat(f))}(this,[a],[])}}});b.exports=e},{"../lib/model.js":8,underscore:"ZKusGn"}],FA0ZaN:[function(a,b){var c=(a("underscore"),a("../lib/model.js")),d=a("../lib/rules.js"),e=a("./board.js"),f=a("./stone.js"),g=a("./move.js"),h=c.extend({attributes:["moves","handicap","komi","black_player","white_player","current_turn"],defaults:{moves:[],handicap:0,current_turn:f.BLACK},methods:{initialize:function(a){return a.moves.length>0&&(a.moves=a.moves.map(function(a){return new g(a)})),a},board:function(){return function a(b,c){if(0===c.length)return b.slice(-1)[0];var e=d.playMove(b,c[0]);return a(b.concat(e),c.slice(1))}([new e],this.moves)}}});b.exports=h},{"../lib/model.js":8,"../lib/rules.js":9,"./board.js":10,"./move.js":13,"./stone.js":14,underscore:"ZKusGn"}],game:[function(a,b){b.exports=a("FA0ZaN")},{}],13:[function(a,b){var c=a("../lib/model.js"),d=c.extend({attributes:["x","y","color"]});b.exports=d},{"../lib/model.js":8}],14:[function(a,b){var c=(a("underscore"),a("../lib/model.js")),d=c.extend({attributes:["x","y","color"]});d.BLACK=0,d.WHITE=1,b.exports=d},{"../lib/model.js":8,underscore:"ZKusGn"}]},{},["uovHxG"]);var React=require("react"),TesujiApp=require("tesuji_app"),Router=require("director").Router,Game=require("game"),routes={"/game":function(){console.log("errp!"),React.renderComponent(TesujiApp({game:new Game}),document.getElementById("tesuji_app"))},"/game/.*":function(){var a;try{a=JSON.parse(atob(window.location.hash.slice(7)))}catch(b){console.log("inavlid game data"+b)}var c=a?new Game(a):new Game;React.renderComponent(TesujiApp({game:c}),document.getElementById("tesuji_app"))},"/errp":function(){console.log("derrp")}},router=new Router(routes);router.init();